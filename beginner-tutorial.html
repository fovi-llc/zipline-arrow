
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial &#8212; Zipline 3.0 docs</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'beginner-tutorial';</script>
    <link rel="icon" href="_static/zipline.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data" href="bundles.html" />
    <link rel="prev" title="Installation" href="install.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    <p class="title logo__title">Zipline 3.0 docs</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Tutorial
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="bundles.html">
                        Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="trading-calendars.html">
                        Calendars
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="risk-and-perf-metrics.html">
                        Metrics
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="development-guidelines.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api-reference.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="releases.html">
                        Releases
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://ml4trading.io">
                    ML for Trading
                  </a>
                </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://exchange.ml4trading.io">
                    Community
                  </a>
                </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/stefan-jansen/zipline-reloaded" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/ml4trading" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="install.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Tutorial
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="bundles.html">
                        Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="trading-calendars.html">
                        Calendars
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="risk-and-perf-metrics.html">
                        Metrics
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="development-guidelines.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api-reference.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="releases.html">
                        Releases
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://ml4trading.io">
                    ML for Trading
                  </a>
                </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://exchange.ml4trading.io">
                    Community
                  </a>
                </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/stefan-jansen/zipline-reloaded" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/ml4trading" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Tutorial</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading">#</a></h1>
<p>Zipline is an <a class="reference external" href="https://github.com/stefan-jansen/zipline-reloaded">open-source</a> algorithmic trading simulator written in
Python.</p>
<p>Some benefits include:</p>
<ul class="simple">
<li><p><strong>Realistic</strong>: slippage, transaction costs, order delays.</p></li>
<li><p><strong>Stream-based</strong>: Process each event individually, avoids look-ahead
bias.</p></li>
<li><p><strong>Batteries included</strong>: Common transforms (moving average) as well as
common risk calculations (Sharpe) can be computed efficiently while executing a backtest.</p></li>
</ul>
<p>This tutorial assumes that you have Zipline correctly installed, see the
<a class="reference internal" href="install.html#install"><span class="std std-ref">Installation</span></a> instructions if you haven’t done so yet.</p>
<section id="how-to-construct-an-algorithm">
<h2>How to construct an algorithm<a class="headerlink" href="#how-to-construct-an-algorithm" title="Permalink to this heading">#</a></h2>
<p>Every Zipline algorithm consists of two functions you have to define:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">initialize(context)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">handle_data(context,</span> <span class="pre">data)</span></code></p></li>
</ul>
<p>Before the start of the algorithm, Zipline calls the
<code class="docutils literal notranslate"><span class="pre">initialize()</span></code> function and passes in a <code class="docutils literal notranslate"><span class="pre">context</span></code> variable.
<code class="docutils literal notranslate"><span class="pre">context</span></code> is a persistent namespace for you to store variables you
need to access from one algorithm iteration to the next.</p>
<p>After the algorithm has been initialized, Zipline calls the
<code class="docutils literal notranslate"><span class="pre">handle_data()</span></code> function once for each event. At every call, it passes
the same <code class="docutils literal notranslate"><span class="pre">context</span></code> variable and an event-frame called <code class="docutils literal notranslate"><span class="pre">data</span></code>
containing the current trading bar with open, high, low, and close
(OHLC) prices as well as volume for each stock in your universe.</p>
<section id="a-simple-example">
<h3>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this heading">#</a></h3>
<p>Let’s take a look at a very simple algorithm from the
<a class="reference external" href="https://github.com/stefan-jansen/zipline-reloaded/tree/main/src/zipline/examples">zipline/examples</a> directory,
<code class="docutils literal notranslate"><span class="pre">buyapple.py</span></code>. Each period, which is a trading day, it orders 10 shares of the Apple stock and records the price.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zipline.examples</span> <span class="kn">import</span> <span class="n">buyapple</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zipline.api</span> <span class="kn">import</span> <span class="n">order</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">symbol</span>


<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">order</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">record</span><span class="p">(</span><span class="n">AAPL</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">),</span> <span class="s1">&#39;price&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>As you can see, we first have to import some functions we would like to
use. All functions commonly used in your algorithm can be found in
<code class="docutils literal notranslate"><span class="pre">zipline.api</span></code>. Here we are using <a class="reference internal" href="api-reference.html#zipline.api.order" title="zipline.api.order"><code class="xref py py-func docutils literal notranslate"><span class="pre">order()</span></code></a> which takes two
arguments: a security object, and a number specifying how many stocks you would
like to order (if negative, <a class="reference internal" href="api-reference.html#zipline.api.order" title="zipline.api.order"><code class="xref py py-func docutils literal notranslate"><span class="pre">order()</span></code></a> will sell/short
stocks). In this case we want to order 10 shares of Apple at each iteration.</p>
<p>Finally, the <a class="reference internal" href="api-reference.html#zipline.api.record" title="zipline.api.record"><code class="xref py py-func docutils literal notranslate"><span class="pre">record()</span></code></a> function allows you to save the value
of a variable at each iteration. You provide it with a name for the variable
together with the variable itself: <code class="docutils literal notranslate"><span class="pre">varname=var</span></code>. After the algorithm
finished running you will have access to each variable value you tracked
with <a class="reference internal" href="api-reference.html#zipline.api.record" title="zipline.api.record"><code class="xref py py-func docutils literal notranslate"><span class="pre">record()</span></code></a> under the name you provided (we will see this
further below). You also see how we can access the current price data of the
AAPL stock in the <code class="docutils literal notranslate"><span class="pre">data</span></code> event frame.</p>
</section>
</section>
<section id="how-to-run-the-algorithm">
<h2>How to run the algorithm<a class="headerlink" href="#how-to-run-the-algorithm" title="Permalink to this heading">#</a></h2>
<p>To now test this algorithm on financial data, Zipline provides three interfaces:
1. the command line via the <code class="docutils literal notranslate"><span class="pre">zipline</span></code> command,
2. the <code class="docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">Notebook</span></code> via the <code class="docutils literal notranslate"><span class="pre">zipline</span></code> magic, and
3. the <a class="reference internal" href="api-reference.html#zipline.run_algorithm" title="zipline.run_algorithm"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_algorithm()</span></code></a> to execute your algo like any Python script, for example in your IDE.</p>
<p>Before we can run any algorithms, we need some data.</p>
<section id="ingesting-data">
<h3>Ingesting Data<a class="headerlink" href="#ingesting-data" title="Permalink to this heading">#</a></h3>
<p>If you haven’t ingested data yet, then run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>zipline<span class="w"> </span>ingest<span class="w"> </span>-b<span class="w"> </span>&lt;bundle&gt;
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;bundle&gt;</span></code> is the name of the bundle to ingest. You can use the default <cite>quandl</cite> for now to work with
the <a class="reference external" href="https://www.quandl.com/databases/WIKIP/documentation?anchor=companies">Quandl WIKI price data</a>. Check out
the <a class="reference internal" href="bundles.html#ingesting-data"><span class="std std-ref">ingesting data</span></a> section for more detail on how to obtain other new data.</p>
</section>
<section id="command-line-interface">
<h3>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this heading">#</a></h3>
<p>After you installed Zipline you should be able to execute the following
from your command line (e.g. <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> on Windows, the Terminal app on OSX, or e.g. the bash shell on Linux):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>zipline<span class="w"> </span>run<span class="w"> </span>--help
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">zipline</span> <span class="n">run</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="p">]</span>

<span class="n">Run</span> <span class="n">a</span> <span class="n">backtest</span> <span class="k">for</span> <span class="n">the</span> <span class="n">given</span> <span class="n">algorithm</span><span class="o">.</span>

<span class="n">Options</span><span class="p">:</span>
 <span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="o">--</span><span class="n">algofile</span> <span class="n">FILENAME</span>         <span class="n">The</span> <span class="n">file</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">algorithm</span> <span class="n">to</span> <span class="n">run</span><span class="o">.</span>
 <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">--</span><span class="n">algotext</span> <span class="n">TEXT</span>             <span class="n">The</span> <span class="n">algorithm</span> <span class="n">script</span> <span class="n">to</span> <span class="n">run</span><span class="o">.</span>
 <span class="o">-</span><span class="n">D</span><span class="p">,</span> <span class="o">--</span><span class="n">define</span> <span class="n">TEXT</span>               <span class="n">Define</span> <span class="n">a</span> <span class="n">name</span> <span class="n">to</span> <span class="n">be</span> <span class="n">bound</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">namespace</span>
                                 <span class="n">before</span> <span class="n">executing</span> <span class="n">the</span> <span class="n">algotext</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span>
                                 <span class="s1">&#39;-Dname=value&#39;</span><span class="o">.</span> <span class="n">The</span> <span class="n">value</span> <span class="n">may</span> <span class="n">be</span> <span class="nb">any</span> <span class="n">python</span>
                                 <span class="n">expression</span><span class="o">.</span> <span class="n">These</span> <span class="n">are</span> <span class="n">evaluated</span> <span class="ow">in</span> <span class="n">order</span> <span class="n">so</span>
                                 <span class="n">they</span> <span class="n">may</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">previously</span> <span class="n">defined</span> <span class="n">names</span><span class="o">.</span>
 <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">frequency</span> <span class="p">[</span><span class="n">daily</span><span class="o">|</span><span class="n">minute</span><span class="p">]</span>
                                 <span class="n">The</span> <span class="n">data</span> <span class="n">frequency</span> <span class="n">of</span> <span class="n">the</span> <span class="n">simulation</span><span class="o">.</span>
                                 <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">daily</span><span class="p">]</span>
 <span class="o">--</span><span class="n">capital</span><span class="o">-</span><span class="n">base</span> <span class="n">FLOAT</span>            <span class="n">The</span> <span class="n">starting</span> <span class="n">capital</span> <span class="k">for</span> <span class="n">the</span> <span class="n">simulation</span><span class="o">.</span>
                                 <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="mf">10000000.0</span><span class="p">]</span>
 <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">--</span><span class="n">bundle</span> <span class="n">BUNDLE</span><span class="o">-</span><span class="n">NAME</span>        <span class="n">The</span> <span class="n">data</span> <span class="n">bundle</span> <span class="n">to</span> <span class="n">use</span> <span class="k">for</span> <span class="n">the</span> <span class="n">simulation</span><span class="o">.</span>
                                 <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">quandl</span><span class="p">]</span>
 <span class="o">--</span><span class="n">bundle</span><span class="o">-</span><span class="n">timestamp</span> <span class="n">TIMESTAMP</span>    <span class="n">The</span> <span class="n">date</span> <span class="n">to</span> <span class="n">lookup</span> <span class="n">data</span> <span class="n">on</span> <span class="ow">or</span> <span class="n">before</span><span class="o">.</span>
                                 <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">current</span><span class="o">-</span><span class="n">time</span><span class="o">&gt;</span><span class="p">]</span>
 <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="o">--</span><span class="n">start</span> <span class="n">DATE</span>                <span class="n">The</span> <span class="n">start</span> <span class="n">date</span> <span class="n">of</span> <span class="n">the</span> <span class="n">simulation</span><span class="o">.</span>
 <span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="o">--</span><span class="n">end</span> <span class="n">DATE</span>                  <span class="n">The</span> <span class="n">end</span> <span class="n">date</span> <span class="n">of</span> <span class="n">the</span> <span class="n">simulation</span><span class="o">.</span>
 <span class="o">-</span><span class="n">o</span><span class="p">,</span> <span class="o">--</span><span class="n">output</span> <span class="n">FILENAME</span>           <span class="n">The</span> <span class="n">location</span> <span class="n">to</span> <span class="n">write</span> <span class="n">the</span> <span class="n">perf</span> <span class="n">data</span><span class="o">.</span> <span class="n">If</span> <span class="n">this</span>
                                 <span class="ow">is</span> <span class="s1">&#39;-&#39;</span> <span class="n">the</span> <span class="n">perf</span> <span class="n">will</span> <span class="n">be</span> <span class="n">written</span> <span class="n">to</span> <span class="n">stdout</span><span class="o">.</span>
                                 <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="o">-</span><span class="p">]</span>
 <span class="o">--</span><span class="n">trading</span><span class="o">-</span><span class="n">calendar</span> <span class="n">TRADING</span><span class="o">-</span><span class="n">CALENDAR</span>
                                 <span class="n">The</span> <span class="n">calendar</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">LSE</span><span class="o">.</span> <span class="n">NYSE</span>
                                 <span class="ow">is</span> <span class="n">the</span> <span class="n">default</span><span class="o">.</span>
 <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">algo</span> <span class="o">/</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="nb">print</span><span class="o">-</span><span class="n">algo</span>  <span class="n">Print</span> <span class="n">the</span> <span class="n">algorithm</span> <span class="n">to</span> <span class="n">stdout</span><span class="o">.</span>
 <span class="o">--</span><span class="n">benchmark</span><span class="o">-</span><span class="n">file</span>                <span class="n">The</span> <span class="n">csv</span> <span class="n">file</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">benchmark</span>
                                 <span class="n">returns</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">returns</span> <span class="n">columns</span><span class="p">)</span>
 <span class="o">--</span><span class="n">benchmark</span><span class="o">-</span><span class="n">symbol</span>              <span class="n">The</span> <span class="n">instrument</span><span class="s1">&#39;s symbol to be used as</span>
                                 <span class="n">a</span> <span class="n">benchmark</span><span class="o">.</span>
                                 <span class="p">(</span><span class="n">should</span> <span class="n">exist</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">ingested</span> <span class="n">bundle</span><span class="p">)</span>
 <span class="o">--</span><span class="n">benchmark</span><span class="o">-</span><span class="n">sid</span>                 <span class="n">The</span> <span class="n">sid</span> <span class="n">of</span> <span class="n">the</span> <span class="n">instrument</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="k">as</span> <span class="n">a</span>
                                 <span class="n">benchmark</span><span class="o">.</span>
                                 <span class="p">(</span><span class="n">should</span> <span class="n">exist</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">ingested</span> <span class="n">bundle</span><span class="p">)</span>
 <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">benchmark</span>                  <span class="n">This</span> <span class="n">flag</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">benchmark</span> <span class="n">to</span>
                                 <span class="n">zero</span><span class="o">.</span> <span class="n">Alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="ow">and</span> <span class="n">benchmark</span> <span class="n">metrics</span>
                                 <span class="n">are</span> <span class="ow">not</span> <span class="n">calculated</span>
 <span class="o">--</span><span class="n">help</span>                          <span class="n">Show</span> <span class="n">this</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span><span class="o">.</span>
</pre></div>
</div>
<p>As you can see there are a couple of flags that specify where to find your
algorithm (<code class="docutils literal notranslate"><span class="pre">-f</span></code>) as well as parameters specifying which data to use,
defaulting to <code class="docutils literal notranslate"><span class="pre">quandl</span></code>.</p>
<p>There are also arguments for the date range to run the algorithm over
(<code class="docutils literal notranslate"><span class="pre">--start</span></code> and <code class="docutils literal notranslate"><span class="pre">--end</span></code>).To use a benchmark, you need to choose one of the
benchmark options listed before. You can
always use the option (<code class="docutils literal notranslate"><span class="pre">--no-benchmark</span></code>) that uses zero returns as a benchmark (
alpha, beta and benchmark metrics are not calculated in this case).</p>
<p>Finally, you’ll want to save the performance metrics of your algorithm so that you can
analyze how it performed. This is done via the <code class="docutils literal notranslate"><span class="pre">--output</span></code> flag and will cause
it to write the performance <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> in the pickle Python file format.
Note that you can also define a configuration file with these parameters that
you can then conveniently pass to the <code class="docutils literal notranslate"><span class="pre">-c</span></code> option so that you don’t have to
supply the command line args all the time (see the .conf files in the examples
directory).</p>
<p>Thus, to execute our algorithm from above and save the results to
<code class="docutils literal notranslate"><span class="pre">buyapple_out.pickle</span></code>, we call <code class="docutils literal notranslate"><span class="pre">zipline</span> <span class="pre">run</span></code> as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>zipline<span class="w"> </span>run<span class="w"> </span>-f<span class="w"> </span>../zipline/examples/buyapple.py<span class="w"> </span>--start<span class="w"> </span><span class="m">2016</span>-1-1<span class="w"> </span>--end<span class="w"> </span><span class="m">2018</span>-1-1<span class="w"> </span>-o<span class="w"> </span>buyapple_out.pickle<span class="w"> </span>--no-benchmark
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">AAPL</span>
<span class="p">[</span><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">04</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">51.843465</span><span class="p">]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">Performance</span><span class="p">:</span> <span class="n">Simulated</span> <span class="mi">503</span> <span class="n">trading</span> <span class="n">days</span> <span class="n">out</span> <span class="n">of</span> <span class="mf">503.</span>
<span class="p">[</span><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">04</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">51.843598</span><span class="p">]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">Performance</span><span class="p">:</span> <span class="n">first</span> <span class="nb">open</span><span class="p">:</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="p">[</span><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">04</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">51.843672</span><span class="p">]</span> <span class="n">INFO</span><span class="p">:</span> <span class="n">Performance</span><span class="p">:</span> <span class="n">last</span> <span class="n">close</span><span class="p">:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">29</span> <span class="mi">21</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">run</span></code> first calls the <code class="docutils literal notranslate"><span class="pre">initialize()</span></code> function, and then
streams the historical stock price day-by-day through <code class="docutils literal notranslate"><span class="pre">handle_data()</span></code>.
After each call to <code class="docutils literal notranslate"><span class="pre">handle_data()</span></code> we instruct <code class="docutils literal notranslate"><span class="pre">zipline</span></code> to order 10
stocks of AAPL. After the call of the <code class="docutils literal notranslate"><span class="pre">order()</span></code> function, <code class="docutils literal notranslate"><span class="pre">zipline</span></code>
enters the ordered stock and amount in the order book. After the
<code class="docutils literal notranslate"><span class="pre">handle_data()</span></code> function has finished, <code class="docutils literal notranslate"><span class="pre">zipline</span></code> looks for any open
orders and tries to fill them. If the trading volume is high enough for
this stock, the order is executed after adding the commission and
applying the slippage model which models the influence of your order on
the stock price, so your algorithm will be charged more than just the
stock price * 10. (Note, that you can also change the commission and
slippage model that <code class="docutils literal notranslate"><span class="pre">zipline</span></code> uses, see the.</p>
<p>Let’s take a quick look at the performance <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. For this, we
use <code class="docutils literal notranslate"><span class="pre">pandas</span></code> from inside the IPython Notebook and print the first ten
rows. Note that <code class="docutils literal notranslate"><span class="pre">zipline</span></code> makes heavy usage of <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, especially
for data input and outputting so it’s worth spending some time to learn
it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">perf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;buyapple_out.pickle&#39;</span><span class="p">)</span> <span class="c1"># read in perf DataFrame</span>
<span class="n">perf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div style="max-height: 1000px; max-width: 1500px; overflow: auto;">
<table border="1" class="dataframe">
<thead>
  <tr style="text-align: right;">
    <th></th>
    <th>AAPL</th>
    <th>algo_volatility</th>
    <th>algorithm_period_return</th>
    <th>alpha</th>
    <th>benchmark_period_return</th>
    <th>benchmark_volatility</th>
    <th>beta</th>
    <th>capital_used</th>
    <th>ending_cash</th>
    <th>ending_exposure</th>
    <th>ending_value</th>
    <th>excess_return</th>
    <th>gross_leverage</th>
    <th>long_exposure</th>
    <th>long_value</th>
    <th>longs_count</th>
    <th>max_drawdown</th>
    <th>max_leverage</th>
    <th>net_leverage</th>
    <th>orders</th>
    <th>period_close</th>
    <th>period_label</th>
    <th>period_open</th>
    <th>pnl</th>
    <th>portfolio_value</th>
    <th>positions</th>
    <th>returns</th>
    <th>sharpe</th>
    <th>short_exposure</th>
    <th>short_value</th>
    <th>shorts_count</th>
    <th>sortino</th>
    <th>starting_cash</th>
    <th>starting_exposure</th>
    <th>starting_value</th>
    <th>trading_days</th>
    <th>transactions</th>
    <th>treasury_period_return</th>
  </tr>
</thead>
<tbody>
  <tr>
    <th>2016-01-04 21:00:00+00:00</th>
    <td>105.35</td>
    <td>NaN</td>
    <td>0.000000e+00</td>
    <td>NaN</td>
    <td>-0.013983</td>
    <td>NaN</td>
    <td>NaN</td>
    <td>0.0</td>
    <td>10000000.0</td>
    <td>0.0</td>
    <td>0.0</td>
    <td>0.0</td>
    <td>0.000000</td>
    <td>0.0</td>
    <td>0.0</td>
    <td>0</td>
    <td>0.000000e+00</td>
    <td>0.0</td>
    <td>0.000000</td>
    <td>[{\'dt\': 2016-01-04 21:00:00+00:00, \'reason\': N...</td>
    <td>2016-01-04 21:00:00+00:00</td>
    <td>2016-01</td>
    <td>2016-01-04 14:31:00+00:00</td>
    <td>0.0</td>
    <td>10000000.0</td>
    <td>[]</td>
    <td>0.000000e+00</td>
    <td>NaN</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>NaN</td>
    <td>10000000.0</td>
    <td>0.0</td>
    <td>0.0</td>
    <td>1</td>
    <td>[]</td>
    <td>0.0</td>
  </tr>
  <tr>
    <th>2016-01-05 21:00:00+00:00</th>
    <td>102.71</td>
    <td>0.000001</td>
    <td>-1.000000e-07</td>
    <td>-0.000022</td>
    <td>-0.012312</td>
    <td>0.175994</td>
    <td>-0.000006</td>
    <td>-1028.1</td>
    <td>9998971.9</td>
    <td>1027.1</td>
    <td>1027.1</td>
    <td>0.0</td>
    <td>0.000103</td>
    <td>1027.1</td>
    <td>1027.1</td>
    <td>1</td>
    <td>-1.000000e-07</td>
    <td>0.0</td>
    <td>0.000103</td>
    <td>[{\'dt\': 2016-01-05 21:00:00+00:00, \'reason\': N...</td>
    <td>2016-01-05 21:00:00+00:00</td>
    <td>2016-01</td>
    <td>2016-01-05 14:31:00+00:00</td>
    <td>-1.0</td>
    <td>9999999.0</td>
    <td>[{\'sid\': Equity(8 [AAPL]), \'last_sale_price\': ...</td>
    <td>-1.000000e-07</td>
    <td>-11.224972</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>-11.224972</td>
    <td>10000000.0</td>
    <td>0.0</td>
    <td>0.0</td>
    <td>2</td>
    <td>[{\'order_id\': \'4011063b5c094e82a5391527044098b...</td>
    <td>0.0</td>
  </tr>
  <tr>
    <th>2016-01-06 21:00:00+00:00</th>
    <td>100.70</td>
    <td>0.000019</td>
    <td>-2.210000e-06</td>
    <td>-0.000073</td>
    <td>-0.024771</td>
    <td>0.137853</td>
    <td>0.000054</td>
    <td>-1008.0</td>
    <td>9997963.9</td>
    <td>2014.0</td>
    <td>2014.0</td>
    <td>0.0</td>
    <td>0.000201</td>
    <td>2014.0</td>
    <td>2014.0</td>
    <td>1</td>
    <td>-2.210000e-06</td>
    <td>0.0</td>
    <td>0.000201</td>
    <td>[{\'dt\': 2016-01-06 21:00:00+00:00, \'reason\': N...</td>
    <td>2016-01-06 21:00:00+00:00</td>
    <td>2016-01</td>
    <td>2016-01-06 14:31:00+00:00</td>
    <td>-21.1</td>
    <td>9999977.9</td>
    <td>[{\'sid\': Equity(8 [AAPL]), \'last_sale_price\': ...</td>
    <td>-2.110000e-06</td>
    <td>-9.823839</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>-9.588756</td>
    <td>9998971.9</td>
    <td>1027.1</td>
    <td>1027.1</td>
    <td>3</td>
    <td>[{\'order_id\': \'3bf9fe20cc46468d99f741474226c03...</td>
    <td>0.0</td>
  </tr>
  <tr>
    <th>2016-01-07 21:00:00+00:00</th>
    <td>96.45</td>
    <td>0.000064</td>
    <td>-1.081000e-05</td>
    <td>0.000243</td>
    <td>-0.048168</td>
    <td>0.167868</td>
    <td>0.000300</td>
    <td>-965.5</td>
    <td>9996998.4</td>
    <td>2893.5</td>
    <td>2893.5</td>
    <td>0.0</td>
    <td>0.000289</td>
    <td>2893.5</td>
    <td>2893.5</td>
    <td>1</td>
    <td>-1.081000e-05</td>
    <td>0.0</td>
    <td>0.000289</td>
    <td>[{\'dt\': 2016-01-07 21:00:00+00:00, \'reason\': N...</td>
    <td>2016-01-07 21:00:00+00:00</td>
    <td>2016-01</td>
    <td>2016-01-07 14:31:00+00:00</td>
    <td>-86.0</td>
    <td>9999891.9</td>
    <td>[{\'sid\': Equity(8 [AAPL]), \'last_sale_price\': ...</td>
    <td>-8.600019e-06</td>
    <td>-10.592737</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>-9.688947</td>
    <td>9997963.9</td>
    <td>2014.0</td>
    <td>2014.0</td>
    <td>4</td>
    <td>[{\'order_id\': \'6af6aed9fbb44a6bba17e802051b94d...</td>
    <td>0.0</td>
  </tr>
  <tr>
    <th>2016-01-08 21:00:00+00:00</th>
    <td>96.96</td>
    <td>0.000063</td>
    <td>-9.380000e-06</td>
    <td>0.000466</td>
    <td>-0.058601</td>
    <td>0.145654</td>
    <td>0.000311</td>
    <td>-970.6</td>
    <td>9996027.8</td>
    <td>3878.4</td>
    <td>3878.4</td>
    <td>0.0</td>
    <td>0.000388</td>
    <td>3878.4</td>
    <td>3878.4</td>
    <td>1</td>
    <td>-1.081000e-05</td>
    <td>0.0</td>
    <td>0.000388</td>
    <td>[{\'dt\': 2016-01-08 21:00:00+00:00, \'reason\': N...</td>
    <td>2016-01-08 21:00:00+00:00</td>
    <td>2016-01</td>
    <td>2016-01-08 14:31:00+00:00</td>
    <td>14.3</td>
    <td>9999906.2</td>
    <td>[{\'sid\': Equity(8 [AAPL]), \'last_sale_price\': ...</td>
    <td>1.430015e-06</td>
    <td>-7.511729</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>-7.519659</td>
    <td>9996998.4</td>
    <td>2893.5</td>
    <td>2893.5</td>
    <td>5</td>
    <td>[{\'order_id\': \'18f64975732449a18fca06e9c69bf5c...</td>
    <td>0.0</td>
  </tr>
</tbody>
</table>
</div><p>As you can see, there is a row for each trading day, starting on the
first business day of 2016. In the columns you can find various
information about the state of your algorithm. The very first column
<code class="docutils literal notranslate"><span class="pre">AAPL</span></code> was placed there by the <code class="docutils literal notranslate"><span class="pre">record()</span></code> function mentioned earlier
and allows us to plot the price of apple. For example, we could easily
examine now how our portfolio value changed over time compared to the
AAPL stock price.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">pylab</span> <span class="n">inline</span>
<span class="n">figsize</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">perf</span><span class="o">.</span><span class="n">portfolio_value</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Portfolio Value&#39;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">perf</span><span class="o">.</span><span class="n">AAPL</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AAPL Stock Price&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Populating</span> <span class="n">the</span> <span class="n">interactive</span> <span class="n">namespace</span> <span class="kn">from</span> <span class="nn">numpy</span> <span class="ow">and</span> <span class="n">matplotlib</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">Text</span> <span class="n">at</span> <span class="mh">0x10c48c198</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/tutorial_11_2.png" src="_images/tutorial_11_2.png" />
<p>As you can see, our algorithm performance as assessed by the
<code class="docutils literal notranslate"><span class="pre">portfolio_value</span></code> closely matches that of the AAPL stock price. This
is not surprising as our algorithm only bought AAPL every chance it got.</p>
</section>
<section id="jupyter-notebook">
<h3>Jupyter Notebook<a class="headerlink" href="#jupyter-notebook" title="Permalink to this heading">#</a></h3>
<p>The <a class="reference external" href="https://jupyter.org/">Jupyter Notebook</a> is a very
powerful browser-based interface to a Python interpreter (this tutorial
was written in it). As it is a very popular interface for many
quantitative researchers, Zipline provides an easy way to run your
algorithm inside the Notebook without requiring you to use the CLI.</p>
<p>To use it you have to write your algorithm in a cell and let Zipline
know that it is supposed to run this algorithm. This is done via the
<code class="docutils literal notranslate"><span class="pre">%%zipline</span></code> IPython magic command that is available after you
<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">zipline</span></code> from within the IPython Notebook. This magic takes
the same arguments as the command line interface described above. Thus
to run the algorithm from above with the same parameters we just have to
execute the following cell after importing <code class="docutils literal notranslate"><span class="pre">zipline</span></code> to register the
magic.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">zipline</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">zipline</span> <span class="o">--</span><span class="n">start</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span> <span class="o">--</span><span class="n">end</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span>
<span class="kn">from</span> <span class="nn">zipline.api</span> <span class="kn">import</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">record</span>

<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">order</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">record</span><span class="p">(</span><span class="n">AAPL</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">),</span> <span class="s2">&quot;price&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we did not have to specify an input file as above since the
magic will use the contents of the cell and look for your algorithm
functions there. Also, instead of defining an output file we are
specifying a variable name with <code class="docutils literal notranslate"><span class="pre">-o</span></code> that will be created in the name
space and contain the performance <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> we looked at above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div style="max-height: 1000px; max-width: 1500px; overflow: auto;">
<table border="1" class="dataframe">
 <thead>
   <tr style="text-align: right;">
     <th></th>
     <th>AAPL</th>
     <th>algo_volatility</th>
     <th>algorithm_period_return</th>
     <th>alpha</th>
     <th>benchmark_period_return</th>
     <th>benchmark_volatility</th>
     <th>beta</th>
     <th>capital_used</th>
     <th>ending_cash</th>
     <th>ending_exposure</th>
     <th>ending_value</th>
     <th>excess_return</th>
     <th>gross_leverage</th>
     <th>long_exposure</th>
     <th>long_value</th>
     <th>longs_count</th>
     <th>max_drawdown</th>
     <th>max_leverage</th>
     <th>net_leverage</th>
     <th>orders</th>
     <th>period_close</th>
     <th>period_label</th>
     <th>period_open</th>
     <th>pnl</th>
     <th>portfolio_value</th>
     <th>positions</th>
     <th>returns</th>
     <th>sharpe</th>
     <th>short_exposure</th>
     <th>short_value</th>
     <th>shorts_count</th>
     <th>sortino</th>
     <th>starting_cash</th>
     <th>starting_exposure</th>
     <th>starting_value</th>
     <th>trading_days</th>
     <th>transactions</th>
     <th>treasury_period_return</th>
   </tr>
 </thead>
 <tbody>
   <tr>
     <th>2016-01-04 21:00:00+00:00</th>
     <td>105.35</td>
     <td>NaN</td>
     <td>0.000000e+00</td>
     <td>NaN</td>
     <td>-0.013983</td>
     <td>NaN</td>
     <td>NaN</td>
     <td>0.00</td>
     <td>10000000.00</td>
     <td>0.0</td>
     <td>0.0</td>
     <td>0.0</td>
     <td>0.000000</td>
     <td>0.0</td>
     <td>0.0</td>
     <td>0</td>
     <td>0.000000e+00</td>
     <td>0.0</td>
     <td>0.000000</td>
     <td>[{\'created\': 2016-01-04 21:00:00+00:00, \'reaso...</td>
     <td>2016-01-04 21:00:00+00:00</td>
     <td>2016-01</td>
     <td>2016-01-04 14:31:00+00:00</td>
     <td>0.00</td>
     <td>10000000.00</td>
     <td>[]</td>
     <td>0.000000e+00</td>
     <td>NaN</td>
     <td>0</td>
     <td>0</td>
     <td>0</td>
     <td>NaN</td>
     <td>10000000.00</td>
     <td>0.0</td>
     <td>0.0</td>
     <td>1</td>
     <td>[]</td>
     <td>0.0</td>
   </tr>
   <tr>
     <th>2016-01-05 21:00:00+00:00</th>
     <td>102.71</td>
     <td>1.122497e-08</td>
     <td>-1.000000e-09</td>
     <td>-2.247510e-07</td>
     <td>-0.012312</td>
     <td>0.175994</td>
     <td>-6.378047e-08</td>
     <td>-1027.11</td>
     <td>9998972.89</td>
     <td>1027.1</td>
     <td>1027.1</td>
     <td>0.0</td>
     <td>0.000103</td>
     <td>1027.1</td>
     <td>1027.1</td>
     <td>1</td>
     <td>-9.999999e-10</td>
     <td>0.0</td>
     <td>0.000103</td>
     <td>[{\'created\': 2016-01-04 21:00:00+00:00, \'reaso...</td>
     <td>2016-01-05 21:00:00+00:00</td>
     <td>2016-01</td>
     <td>2016-01-05 14:31:00+00:00</td>
     <td>-0.01</td>
     <td>9999999.99</td>
     <td>[{\'amount\': 10, \'cost_basis\': 102.711000000000...</td>
     <td>-1.000000e-09</td>
     <td>-11.224972</td>
     <td>0</td>
     <td>0</td>
     <td>0</td>
     <td>-11.224972</td>
     <td>10000000.00</td>
     <td>0.0</td>
     <td>0.0</td>
     <td>2</td>
     <td>[{\'dt\': 2016-01-05 21:00:00+00:00, \'order_id\':...</td>
     <td>0.0</td>
   </tr>
   <tr>
     <th>2016-01-06 21:00:00+00:00</th>
     <td>100.70</td>
     <td>1.842654e-05</td>
     <td>-2.012000e-06</td>
     <td>-4.883861e-05</td>
     <td>-0.024771</td>
     <td>0.137853</td>
     <td>5.744807e-05</td>
     <td>-1007.01</td>
     <td>9997965.88</td>
     <td>2014.0</td>
     <td>2014.0</td>
     <td>0.0</td>
     <td>0.000201</td>
     <td>2014.0</td>
     <td>2014.0</td>
     <td>1</td>
     <td>-2.012000e-06</td>
     <td>0.0</td>
     <td>0.000201</td>
     <td>[{\'created\': 2016-01-05 21:00:00+00:00, \'reaso...</td>
     <td>2016-01-06 21:00:00+00:00</td>
     <td>2016-01</td>
     <td>2016-01-06 14:31:00+00:00</td>
     <td>-20.11</td>
     <td>9999979.88</td>
     <td>[{\'amount\': 20, \'cost_basis\': 101.706000000000...</td>
     <td>-2.011000e-06</td>
     <td>-9.171989</td>
     <td>0</td>
     <td>0</td>
     <td>0</td>
     <td>-9.169708</td>
     <td>9998972.89</td>
     <td>1027.1</td>
     <td>1027.1</td>
     <td>3</td>
     <td>[{\'dt\': 2016-01-06 21:00:00+00:00, \'order_id\':...</td>
     <td>0.0</td>
   </tr>
   <tr>
     <th>2016-01-07 21:00:00+00:00</th>
     <td>96.45</td>
     <td>6.394658e-05</td>
     <td>-1.051300e-05</td>
     <td>2.633450e-04</td>
     <td>-0.048168</td>
     <td>0.167868</td>
     <td>3.005102e-04</td>
     <td>-964.51</td>
     <td>9997001.37</td>
     <td>2893.5</td>
     <td>2893.5</td>
     <td>0.0</td>
     <td>0.000289</td>
     <td>2893.5</td>
     <td>2893.5</td>
     <td>1</td>
     <td>-1.051300e-05</td>
     <td>0.0</td>
     <td>0.000289</td>
     <td>[{\'created\': 2016-01-06 21:00:00+00:00, \'reaso...</td>
     <td>2016-01-07 21:00:00+00:00</td>
     <td>2016-01</td>
     <td>2016-01-07 14:31:00+00:00</td>
     <td>-85.01</td>
     <td>9999894.87</td>
     <td>[{\'amount\': 30, \'cost_basis\': 99.9543333333335...</td>
     <td>-8.501017e-06</td>
     <td>-10.357397</td>
     <td>0</td>
     <td>0</td>
     <td>0</td>
     <td>-9.552189</td>
     <td>9997965.88</td>
     <td>2014.0</td>
     <td>2014.0</td>
     <td>4</td>
     <td>[{\'dt\': 2016-01-07 21:00:00+00:00, \'order_id\':...</td>
     <td>0.0</td>
   </tr>
   <tr>
     <th>2016-01-08 21:00:00+00:00</th>
     <td>96.96</td>
     <td>6.275294e-05</td>
     <td>-8.984000e-06</td>
     <td>4.879306e-04</td>
     <td>-0.058601</td>
     <td>0.145654</td>
     <td>3.118401e-04</td>
     <td>-969.61</td>
     <td>9996031.76</td>
     <td>3878.4</td>
     <td>3878.4</td>
     <td>0.0</td>
     <td>0.000388</td>
     <td>3878.4</td>
     <td>3878.4</td>
     <td>1</td>
     <td>-1.051300e-05</td>
     <td>0.0</td>
     <td>0.000388</td>
     <td>[{\'created\': 2016-01-07 21:00:00+00:00, \'reaso...</td>
     <td>2016-01-08 21:00:00+00:00</td>
     <td>2016-01</td>
     <td>2016-01-08 14:31:00+00:00</td>
     <td>15.29</td>
     <td>9999910.16</td>
     <td>[{\'amount\': 40, \'cost_basis\': 99.2060000000002...</td>
     <td>1.529016e-06</td>
     <td>-7.215497</td>
     <td>0</td>
     <td>0</td>
     <td>0</td>
     <td>-7.301134</td>
     <td>9997001.37</td>
     <td>2893.5</td>
     <td>2893.5</td>
     <td>5</td>
     <td>[{\'dt\': 2016-01-08 21:00:00+00:00, \'order_id\':...</td>
     <td>0.0</td>
   </tr>
 </tbody>
</table>
</div></section>
<section id="ide-via-run-algorithm">
<h3>IDE via <a class="reference internal" href="api-reference.html#zipline.run_algorithm" title="zipline.run_algorithm"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_algorithm()</span></code></a><a class="headerlink" href="#ide-via-run-algorithm" title="Permalink to this heading">#</a></h3>
<p>To execute an algorithm like a Python script in your favorite IDE, use the <a class="reference internal" href="api-reference.html#zipline.run_algorithm" title="zipline.run_algorithm"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_algorithm()</span></code></a> (see <a class="reference internal" href="api-reference.html#api-reference"><span class="std std-ref">API Reference</span></a>).</p>
<p>To adapt the <code class="docutils literal notranslate"><span class="pre">buyapple.py</span></code> example from above (see <code class="docutils literal notranslate"><span class="pre">buyapple_ide.py</span></code> in the same directory), simply add the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zipline</span> <span class="kn">import</span> <span class="n">run_algorithm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>

<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014&#39;</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018&#39;</span><span class="p">)</span>

<span class="n">sp500</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;SP500&#39;</span><span class="p">,</span> <span class="s1">&#39;fred&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">SP500</span>
<span class="n">benchmark_returns</span> <span class="o">=</span> <span class="n">sp500</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">run_algorithm</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">),</span>
                       <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">),</span>
                       <span class="n">initialize</span><span class="o">=</span><span class="n">initialize</span><span class="p">,</span>
                       <span class="n">handle_data</span><span class="o">=</span><span class="n">handle_data</span><span class="p">,</span>
                       <span class="n">capital_base</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                       <span class="n">benchmark_returns</span><span class="o">=</span><span class="n">benchmark_returns</span><span class="p">,</span>
                       <span class="n">bundle</span><span class="o">=</span><span class="s1">&#39;quandl&#39;</span><span class="p">,</span>
                       <span class="n">data_frequency</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We pass the key algo parameters to <a class="reference internal" href="api-reference.html#zipline.run_algorithm" title="zipline.run_algorithm"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_algorithm()</span></code></a>, including some benchmark data for the S&amp;P 500 that we
download from the <a class="reference external" href="https://fred.stlouisfed.org/series/SP500">Federal Reserve Economic Data Service</a>
(available for the last 10 years).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> return value contains the same <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> as in the previous example. Instead of defining
an <code class="docutils literal notranslate"><span class="pre">analyze()</span></code> function as part of the algorithm, you can apply your preferred logic to this <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
</section>
</section>
<section id="how-to-use-historical-prices-a-dual-moving-average-cross-over-example">
<h2>How to use historical prices: a dual Moving Average Cross-Over example<a class="headerlink" href="#how-to-use-historical-prices-a-dual-moving-average-cross-over-example" title="Permalink to this heading">#</a></h2>
<p>The Dual Moving Average (DMA) is a classic momentum strategy. It’s
probably not used by any serious trader anymore but is still very
instructive. The basic idea is that we compute two rolling or moving
averages (mavg) – one with a longer window that is supposed to capture
long-term trends and one shorter window that is supposed to capture
short-term trends. Once the short-mavg crosses the long-mavg from below
we assume that the stock price has upwards momentum and long the stock.
If the short-mavg crosses from above we exit the positions as we assume
the stock to go down further.</p>
<p>As we need to have access to previous prices to implement this strategy
we need a new concept: History</p>
<p><code class="docutils literal notranslate"><span class="pre">data.history()</span></code> is a convenience function that keeps a rolling window of
data for you. The first argument is the number of bars you want to
collect, the second argument is the unit (either <code class="docutils literal notranslate"><span class="pre">'1d'</span></code> or <code class="docutils literal notranslate"><span class="pre">'1m'</span></code>,
but note that you need to have minute-level data for using <code class="docutils literal notranslate"><span class="pre">1m</span></code>). For
a more detailed description of <code class="docutils literal notranslate"><span class="pre">history()</span></code>’s features, see the <a class="reference internal" href="api-reference.html#api-reference"><span class="std std-ref">API Reference</span></a>.
Let’s look at the strategy which should make this clear:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">zipline</span> <span class="o">--</span><span class="n">start</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span> <span class="o">--</span><span class="n">end</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">o</span> <span class="n">dma</span><span class="o">.</span><span class="n">pickle</span>


<span class="kn">from</span> <span class="nn">zipline.api</span> <span class="kn">import</span> <span class="n">order_target</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">symbol</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">context</span><span class="o">.</span><span class="n">asset</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># Skip first 300 days to get full windows</span>
    <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Compute averages</span>
    <span class="c1"># data.history() has to be called with the same params</span>
    <span class="c1"># from above and returns a pandas dataframe.</span>
    <span class="n">short_mavg</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">bar_count</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;1d&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">long_mavg</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">bar_count</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;1d&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Trading logic</span>
    <span class="k">if</span> <span class="n">short_mavg</span> <span class="o">&gt;</span> <span class="n">long_mavg</span><span class="p">:</span>
        <span class="c1"># order_target orders as many shares as needed to</span>
        <span class="c1"># achieve the desired number of shares.</span>
        <span class="n">order_target</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">short_mavg</span> <span class="o">&lt;</span> <span class="n">long_mavg</span><span class="p">:</span>
        <span class="n">order_target</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Save values for later inspection</span>
    <span class="n">record</span><span class="p">(</span><span class="n">AAPL</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">asset</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">),</span>
           <span class="n">short_mavg</span><span class="o">=</span><span class="n">short_mavg</span><span class="p">,</span>
           <span class="n">long_mavg</span><span class="o">=</span><span class="n">long_mavg</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">perf</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
    <span class="n">perf</span><span class="o">.</span><span class="n">portfolio_value</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;portfolio value in $&#39;</span><span class="p">)</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
    <span class="n">perf</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
    <span class="n">perf</span><span class="p">[[</span><span class="s1">&#39;short_mavg&#39;</span><span class="p">,</span> <span class="s1">&#39;long_mavg&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>

    <span class="n">perf_trans</span> <span class="o">=</span> <span class="n">perf</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">t</span> <span class="o">!=</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">perf</span><span class="o">.</span><span class="n">transactions</span><span class="p">]]</span>
    <span class="n">buys</span> <span class="o">=</span> <span class="n">perf_trans</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">perf_trans</span><span class="o">.</span><span class="n">transactions</span><span class="p">]]</span>
    <span class="n">sells</span> <span class="o">=</span> <span class="n">perf_trans</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">perf_trans</span><span class="o">.</span><span class="n">transactions</span><span class="p">]]</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">buys</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">perf</span><span class="o">.</span><span class="n">short_mavg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">buys</span><span class="o">.</span><span class="n">index</span><span class="p">],</span>
             <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sells</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">perf</span><span class="o">.</span><span class="n">short_mavg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sells</span><span class="o">.</span><span class="n">index</span><span class="p">],</span>
             <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;price in $&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/tutorial_22_1.png" src="_images/tutorial_22_1.png" />
<p>Here we are explicitly defining an <code class="docutils literal notranslate"><span class="pre">analyze()</span></code> function that gets
automatically called once the backtest is done.</p>
<p>Although it might not be directly apparent, the power of <code class="docutils literal notranslate"><span class="pre">history()</span></code>
(pun intended) can not be under-estimated as most algorithms make use of
prior market developments in one form or another. You could easily
devise a strategy that trains a classifier with
<a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a> which tries to
predict future market movements based on past prices (note, that most of
the <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> functions require <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>s rather than
<code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>s, so you can simply pass the underlying
<code class="docutils literal notranslate"><span class="pre">ndarray</span></code> of a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> via <code class="docutils literal notranslate"><span class="pre">.to_numpy()</span></code>).</p>
<p>We also used the <code class="docutils literal notranslate"><span class="pre">order_target()</span></code> function above. This and other
functions like it can make order management and portfolio rebalancing
much easier. See the <a class="reference internal" href="api-reference.html#api-reference"><span class="std std-ref">API Reference</span></a> for
more details.</p>
<section id="conclusions">
<h3>Conclusions<a class="headerlink" href="#conclusions" title="Permalink to this heading">#</a></h3>
<p>We hope that this tutorial gave you a little insight into the
architecture, API, and features of <code class="docutils literal notranslate"><span class="pre">zipline</span></code>. For next steps, check
out some of the
<a class="reference external" href="https://github.com/stefan-jansen/zipline-reloaded/tree/main/src/zipline/examples">examples</a>.</p>
<p>Feel free to ask questions on <a class="reference external" href="https://groups.google.com/forum/#!forum/zipline">our mailing
list</a>, report
problems on our <a class="reference external" href="https://github.com/stefan-jansen/zipline-reloaded/issues?state=open">GitHub issue
tracker</a>,
or <a class="reference external" href="https://exchange.ml4trading.io">get involved</a>.</p>
</section>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="install.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Installation</p>
      </div>
    </a>
    <a class="right-next"
       href="bundles.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-construct-an-algorithm">How to construct an algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-example">A simple example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-run-the-algorithm">How to run the algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ingesting-data">Ingesting Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#command-line-interface">Command Line Interface</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jupyter-notebook">Jupyter Notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ide-via-run-algorithm">IDE via <code class="xref py py-func docutils literal notranslate"><span class="pre">run_algorithm()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-historical-prices-a-dual-moving-average-cross-over-example">How to use historical prices: a dual Moving Average Cross-Over example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/beginner-tutorial.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2020, Quantopian Inc..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>